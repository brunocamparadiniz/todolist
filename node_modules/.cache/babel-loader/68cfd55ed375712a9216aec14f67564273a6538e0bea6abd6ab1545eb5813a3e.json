{"ast":null,"code":"'use strict';\n\nvar _toConsumableArray = require(\"/Users/brunocamparadiniz/Desktop/coding/BC-AY/react/todolist/node_modules/@babel/runtime/helpers/toConsumableArray.js\").default;\nvar _classCallCheck = require(\"/Users/brunocamparadiniz/Desktop/coding/BC-AY/react/todolist/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\nvar _createClass = require(\"/Users/brunocamparadiniz/Desktop/coding/BC-AY/react/todolist/node_modules/@babel/runtime/helpers/createClass.js\").default;\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nexports.default = void 0;\nvar _FifoQueue = _interopRequireDefault(require('./FifoQueue'));\nvar _types = require('./types');\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}\nvar Farm = /*#__PURE__*/function () {\n  function Farm(_numOfWorkers, _callback) {\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    _classCallCheck(this, Farm);\n    var _options$workerSchedu, _options$taskQueue;\n    _defineProperty(this, '_computeWorkerKey', void 0);\n    _defineProperty(this, '_workerSchedulingPolicy', void 0);\n    _defineProperty(this, '_cacheKeys', Object.create(null));\n    _defineProperty(this, '_locks', []);\n    _defineProperty(this, '_offset', 0);\n    _defineProperty(this, '_taskQueue', void 0);\n    this._numOfWorkers = _numOfWorkers;\n    this._callback = _callback;\n    this._computeWorkerKey = options.computeWorkerKey;\n    this._workerSchedulingPolicy = (_options$workerSchedu = options.workerSchedulingPolicy) !== null && _options$workerSchedu !== void 0 ? _options$workerSchedu : 'round-robin';\n    this._taskQueue = (_options$taskQueue = options.taskQueue) !== null && _options$taskQueue !== void 0 ? _options$taskQueue : new _FifoQueue.default();\n  }\n  _createClass(Farm, [{\n    key: \"doWork\",\n    value: function doWork(method) {\n      var _this = this;\n      var customMessageListeners = new Set();\n      var addCustomMessageListener = function addCustomMessageListener(listener) {\n        customMessageListeners.add(listener);\n        return function () {\n          customMessageListeners.delete(listener);\n        };\n      };\n      var onCustomMessage = function onCustomMessage(message) {\n        customMessageListeners.forEach(function (listener) {\n          return listener(message);\n        });\n      };\n      for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n        args[_key - 1] = arguments[_key];\n      }\n      var promise = new Promise(\n      // Bind args to this function so it won't reference to the parent scope.\n      // This prevents a memory leak in v8, because otherwise the function will\n      // retaine args for the closure.\n      function (args, resolve, reject) {\n        var computeWorkerKey = _this._computeWorkerKey;\n        var request = [_types.CHILD_MESSAGE_CALL, false, method, args];\n        var worker = null;\n        var hash = null;\n        if (computeWorkerKey) {\n          hash = computeWorkerKey.call.apply(computeWorkerKey, [_this, method].concat(_toConsumableArray(args)));\n          worker = hash == null ? null : _this._cacheKeys[hash];\n        }\n        var onStart = function onStart(worker) {\n          if (hash != null) {\n            _this._cacheKeys[hash] = worker;\n          }\n        };\n        var onEnd = function onEnd(error, result) {\n          customMessageListeners.clear();\n          if (error) {\n            reject(error);\n          } else {\n            resolve(result);\n          }\n        };\n        var task = {\n          onCustomMessage: onCustomMessage,\n          onEnd: onEnd,\n          onStart: onStart,\n          request: request\n        };\n        if (worker) {\n          _this._taskQueue.enqueue(task, worker.getWorkerId());\n          _this._process(worker.getWorkerId());\n        } else {\n          _this._push(task);\n        }\n      }.bind(null, args));\n      promise.UNSTABLE_onCustomMessage = addCustomMessageListener;\n      return promise;\n    }\n  }, {\n    key: \"_process\",\n    value: function _process(workerId) {\n      var _this2 = this;\n      if (this._isLocked(workerId)) {\n        return this;\n      }\n      var task = this._taskQueue.dequeue(workerId);\n      if (!task) {\n        return this;\n      }\n      if (task.request[1]) {\n        throw new Error('Queue implementation returned processed task');\n      } // Reference the task object outside so it won't be retained by onEnd,\n      // and other properties of the task object, such as task.request can be\n      // garbage collected.\n\n      var taskOnEnd = task.onEnd;\n      var onEnd = function onEnd(error, result) {\n        taskOnEnd(error, result);\n        _this2._unlock(workerId);\n        _this2._process(workerId);\n      };\n      task.request[1] = true;\n      this._lock(workerId);\n      this._callback(workerId, task.request, task.onStart, onEnd, task.onCustomMessage);\n      return this;\n    }\n  }, {\n    key: \"_push\",\n    value: function _push(task) {\n      this._taskQueue.enqueue(task);\n      var offset = this._getNextWorkerOffset();\n      for (var i = 0; i < this._numOfWorkers; i++) {\n        this._process((offset + i) % this._numOfWorkers);\n        if (task.request[1]) {\n          break;\n        }\n      }\n      return this;\n    }\n  }, {\n    key: \"_getNextWorkerOffset\",\n    value: function _getNextWorkerOffset() {\n      switch (this._workerSchedulingPolicy) {\n        case 'in-order':\n          return 0;\n        case 'round-robin':\n          return this._offset++;\n      }\n    }\n  }, {\n    key: \"_lock\",\n    value: function _lock(workerId) {\n      this._locks[workerId] = true;\n    }\n  }, {\n    key: \"_unlock\",\n    value: function _unlock(workerId) {\n      this._locks[workerId] = false;\n    }\n  }, {\n    key: \"_isLocked\",\n    value: function _isLocked(workerId) {\n      return this._locks[workerId];\n    }\n  }]);\n  return Farm;\n}();\nexports.default = Farm;","map":{"version":3,"names":["Object","defineProperty","exports","value","default","_FifoQueue","_interopRequireDefault","require","_types","obj","__esModule","_defineProperty","key","enumerable","configurable","writable","Farm","_numOfWorkers","_callback","options","_options$workerSchedu","_options$taskQueue","create","_computeWorkerKey","computeWorkerKey","_workerSchedulingPolicy","workerSchedulingPolicy","_taskQueue","taskQueue","method","customMessageListeners","Set","addCustomMessageListener","listener","add","delete","onCustomMessage","message","forEach","args","promise","Promise","resolve","reject","request","CHILD_MESSAGE_CALL","worker","hash","call","_cacheKeys","onStart","onEnd","error","result","clear","task","enqueue","getWorkerId","_process","_push","bind","UNSTABLE_onCustomMessage","workerId","_isLocked","dequeue","Error","taskOnEnd","_unlock","_lock","offset","_getNextWorkerOffset","i","_offset","_locks"],"sources":["/Users/brunocamparadiniz/Desktop/coding/BC-AY/react/todolist/node_modules/jest-worker/build/Farm.js"],"sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nexports.default = void 0;\n\nvar _FifoQueue = _interopRequireDefault(require('./FifoQueue'));\n\nvar _types = require('./types');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {default: obj};\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}\n\nclass Farm {\n  constructor(_numOfWorkers, _callback, options = {}) {\n    var _options$workerSchedu, _options$taskQueue;\n\n    _defineProperty(this, '_computeWorkerKey', void 0);\n\n    _defineProperty(this, '_workerSchedulingPolicy', void 0);\n\n    _defineProperty(this, '_cacheKeys', Object.create(null));\n\n    _defineProperty(this, '_locks', []);\n\n    _defineProperty(this, '_offset', 0);\n\n    _defineProperty(this, '_taskQueue', void 0);\n\n    this._numOfWorkers = _numOfWorkers;\n    this._callback = _callback;\n    this._computeWorkerKey = options.computeWorkerKey;\n    this._workerSchedulingPolicy =\n      (_options$workerSchedu = options.workerSchedulingPolicy) !== null &&\n      _options$workerSchedu !== void 0\n        ? _options$workerSchedu\n        : 'round-robin';\n    this._taskQueue =\n      (_options$taskQueue = options.taskQueue) !== null &&\n      _options$taskQueue !== void 0\n        ? _options$taskQueue\n        : new _FifoQueue.default();\n  }\n\n  doWork(method, ...args) {\n    const customMessageListeners = new Set();\n\n    const addCustomMessageListener = listener => {\n      customMessageListeners.add(listener);\n      return () => {\n        customMessageListeners.delete(listener);\n      };\n    };\n\n    const onCustomMessage = message => {\n      customMessageListeners.forEach(listener => listener(message));\n    };\n\n    const promise = new Promise( // Bind args to this function so it won't reference to the parent scope.\n      // This prevents a memory leak in v8, because otherwise the function will\n      // retaine args for the closure.\n      ((args, resolve, reject) => {\n        const computeWorkerKey = this._computeWorkerKey;\n        const request = [_types.CHILD_MESSAGE_CALL, false, method, args];\n        let worker = null;\n        let hash = null;\n\n        if (computeWorkerKey) {\n          hash = computeWorkerKey.call(this, method, ...args);\n          worker = hash == null ? null : this._cacheKeys[hash];\n        }\n\n        const onStart = worker => {\n          if (hash != null) {\n            this._cacheKeys[hash] = worker;\n          }\n        };\n\n        const onEnd = (error, result) => {\n          customMessageListeners.clear();\n\n          if (error) {\n            reject(error);\n          } else {\n            resolve(result);\n          }\n        };\n\n        const task = {\n          onCustomMessage,\n          onEnd,\n          onStart,\n          request\n        };\n\n        if (worker) {\n          this._taskQueue.enqueue(task, worker.getWorkerId());\n\n          this._process(worker.getWorkerId());\n        } else {\n          this._push(task);\n        }\n      }).bind(null, args)\n    );\n    promise.UNSTABLE_onCustomMessage = addCustomMessageListener;\n    return promise;\n  }\n\n  _process(workerId) {\n    if (this._isLocked(workerId)) {\n      return this;\n    }\n\n    const task = this._taskQueue.dequeue(workerId);\n\n    if (!task) {\n      return this;\n    }\n\n    if (task.request[1]) {\n      throw new Error('Queue implementation returned processed task');\n    } // Reference the task object outside so it won't be retained by onEnd,\n    // and other properties of the task object, such as task.request can be\n    // garbage collected.\n\n    const taskOnEnd = task.onEnd;\n\n    const onEnd = (error, result) => {\n      taskOnEnd(error, result);\n\n      this._unlock(workerId);\n\n      this._process(workerId);\n    };\n\n    task.request[1] = true;\n\n    this._lock(workerId);\n\n    this._callback(\n      workerId,\n      task.request,\n      task.onStart,\n      onEnd,\n      task.onCustomMessage\n    );\n\n    return this;\n  }\n\n  _push(task) {\n    this._taskQueue.enqueue(task);\n\n    const offset = this._getNextWorkerOffset();\n\n    for (let i = 0; i < this._numOfWorkers; i++) {\n      this._process((offset + i) % this._numOfWorkers);\n\n      if (task.request[1]) {\n        break;\n      }\n    }\n\n    return this;\n  }\n\n  _getNextWorkerOffset() {\n    switch (this._workerSchedulingPolicy) {\n      case 'in-order':\n        return 0;\n\n      case 'round-robin':\n        return this._offset++;\n    }\n  }\n\n  _lock(workerId) {\n    this._locks[workerId] = true;\n  }\n\n  _unlock(workerId) {\n    this._locks[workerId] = false;\n  }\n\n  _isLocked(workerId) {\n    return this._locks[workerId];\n  }\n}\n\nexports.default = Farm;\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}